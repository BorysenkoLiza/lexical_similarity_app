<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results of Document Clustering</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; display: flex; }
        h1, h2, h3, h4 { color: #333; }
        ul { list-style-type: none; padding: 0; }
        li { margin-bottom: 10px; }
        .sidebar { width: 200px; background-color: #f4f4f4; padding: 20px; height: 100vh; position: fixed; overflow-y: auto; }
        .content { margin-left: 220px; padding: 20px; width: calc(100% - 220px); }
        .cluster-section, .visualization-section { display: none; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .active { display: block; }
        .tab-menu { display: flex; margin-bottom: 20px; }
        .tab-menu button { padding: 10px 20px; border: none; background-color: #f4f4f4; cursor: pointer; }
        .tab-menu button.active { background-color: #ddd; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Menu</h2>
        <ul>
            <li><a href="#" onclick="showVisualization()">Show All</a></li>
            {% for label in clusters.keys() %}
                <li><a href="#" onclick="showCluster({{ label }})">Cluster {{ label }}</a></li>
            {% endfor %}
        </ul>
    </div>
    <div class="content">
        <h1>Lexical Proximity Results</h1>
        <div id="visualization" class="tab-content visualization-section">
            <form action="{{ url_for('find_similar') }}" method="POST">
                <label for="fileName">Document Name:</label>
                <input type="text" id="fileName" name="fileName" required>
                <label for="similarityThreshold">Similarity Threshold:</label>
                <input type="number" step="0.01" id="similarityThreshold" name="similarityThreshold" required>
                <button type="submit">Find Similar Documents</button>
            </form>
            <!-- Placeholder for displaying similar documents -->
            <div id="similar-documents">
                {% if similar_docs %}
                    <h3>Similar Documents for {{ file_name }}</h3>
                    <table>
                        <tr>
                            <th>Similar Document</th>
                            <th>Similarity Score</th>
                        </tr>
                        {% for doc1, doc2, similarity in similar_docs %}
                            <tr>
                                <td>{{ doc_names[doc1] if doc1 == file_name else doc_names[doc2] }}</td>
                                <td>{{ similarity|round(4) }}</td>
                            </tr>
                        {% endfor %}
                    </table>
                {% endif %}
            </div>
        </div>
        <div id="clusters" class="tab-content">
            {% for label, docs in clusters.items() %}
                <div id="cluster-{{ label }}" class="cluster-section">
                    <h3>Cluster {{ label }} ({{ docs|length }} documents)</h3>
                    <p><strong>Top Terms:</strong> {{ cluster_top_terms[label] }}</p>
                    <table>
                        <tr>
                            <th>Documents in cluster</th>
                            <th>Representative Document</th>
                            <th>Most Similar Documents</th>
                            <th>Similarity Score</th>
                        </tr>
                        <tr>
                            <td>
                                <ul>
                                {% for doc in docs[:10] %}
                                    <li>{{ doc['DocName'] }} (ID: {{ doc['DocID'] }})</li>
                                {% endfor %}
                                {% if docs|length > 10 %}
                                    <li>... ({{ docs|length }} total)</li>
                                {% endif %}
                                </ul>
                            </td>
                            <td rowspan="{{ cluster_similarities[label]|length }}">{{ docs[0]['DocName'] }} (ID: {{ docs[0]['DocID'] }})</td>
                            <td>
                                <ul>
                                    {% for doc1, doc2, similarity in cluster_similarities[label] %}
                                        <li>{{ doc_names[doc1] }} & {{ doc_names[doc2] }}</li>
                                    {% endfor %}
                                </ul>
                            </td>
                            <td>
                                <ul>
                                    {% for doc1, doc2, similarity in cluster_similarities[label] %}
                                        <li>{{ similarity|round(4) }}</li>
                                    {% endfor %}
                                </ul>
                            </td>
                        </tr>
                    </table>
                </div>
            {% endfor %}
        </div>
    </div>
    <script>
        function showCluster(clusterId) {
            // Hide all cluster sections
            var sections = document.getElementsByClassName('cluster-section');
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }

            // Show the selected cluster section
            var selectedSection = document.getElementById('cluster-' + clusterId);
            if (selectedSection) {
                selectedSection.classList.add('active');
            }

            // Switch to the clusters tab
            showTab('clusters');
        }

        function showVisualization() {
            // Hide all cluster sections
            var sections = document.getElementsByClassName('cluster-section');
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }

            // Show the visualization section
            var visualizationSection = document.getElementById('visualization');
            if (visualizationSection) {
                visualizationSection.classList.add('active');
            }
        }

        function showTab(tabId) {
            // Hide all tab content
            var tabs = document.getElementsByClassName('tab-content');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }

            // Show the selected tab content
            var selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
        }

        // Initialize the first tab as active
        document.addEventListener('DOMContentLoaded', function() {
            showTab('visualization');
        });
    </script>
</body>
</html>